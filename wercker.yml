box: wercker/nodejs
build:
  steps:
    - script:
        name: install global dependencies
        code: sudo npm install -g gulp
    - script:
        name: install local dependencies
        code: npm install
    - script:
        name: run tests
        code: |
            gulp test
            gulp browserify.libs
            gulp browserify
            node_modules/karma/bin/karma start --single-run --browsers PhantomJS
    - script:
        name: build production
        code: gulp build
deploy:
  steps:
    - s3sync:
        key-id: $KEY
        key-secret: $SECRET
        bucket-url: $BUCKET
        source-dir: ./dist